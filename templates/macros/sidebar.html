{% macro sidebar(config, lang, current_path, section) %}
<label for="my-drawer-2" class="drawer-overlay"></label>
<div class="p-4 w-80 min-h-full text-base-content overflow-y-auto">
    <ul class="menu w-full mt-4">
        {% set index = get_section(path="_index.md") %}
        {# Level 1 #}
        {% for s1_path in index.subsections %}
            {% set s1 = get_section(path=s1_path) %}
            {% set is_active1 = current_path is starting_with(s1.path) %}
            <li>
                {% if s1.subsections or s1.pages %}
                    <details {% if is_active1 or (config.extra.sidebar_expand_depth | default(0)) >= 1 %}open{% endif %}>
                        <summary {% if current_path == s1.path %}class="rounded bg-gray-500/15"{% endif %}>
                            {{ s1.title }}
                        </summary>
                        <ul>
                            {# Level 2 #}
                            {% for s2_path in s1.subsections %}
                                {% set s2 = get_section(path=s2_path) %}
                                {% set is_active2 = current_path is starting_with(s2.path) %}
                                <li>
                                    {% if s2.subsections or s2.pages %}
                                        <details {% if is_active2 or (config.extra.sidebar_expand_depth | default(0)) >= 2 %}open{% endif %}>
                                            <summary {% if current_path == s2.path %}class="rounded bg-gray-500/15"{% endif %}>
                                                <a class="hover:no-underline" href="{{ get_url(path=s2.path, lang=lang) | safe }}">{{ s2.title }}</a>
                                            </summary>
                                            <ul>
                                                {# Level 3 #}
                                                {% for s3_path in s2.subsections %}
                                                    {% set s3 = get_section(path=s3_path) %}
                                                    {% set is_active3 = current_path is starting_with(s3.path) %}
                                                    <li>
                                                        {% if s3.subsections or s3.pages %}
                                                            <details {% if is_active3 or (config.extra.sidebar_expand_depth | default(0)) >= 3 %}open{% endif %}>
                                                                <summary {% if current_path == s3.path %}class="rounded bg-gray-500/15"{% endif %}>
                                                                    <a class="hover:no-underline" href="{{ get_url(path=s3.path, lang=lang) | safe }}">{{ s3.title }}</a>
                                                                </summary>
                                                                <ul>
                                                                    {# Level 4 #}
                                                                    {% for s4_path in s3.subsections %}
                                                                        {% set s4 = get_section(path=s4_path) %}
                                                                        {% set is_active4 = current_path is starting_with(s4.path) %}
                                                                        <li>
                                                                            {% if s4.subsections or s4.pages %}
                                                                                <details {% if is_active4 or (config.extra.sidebar_expand_depth | default(0)) >= 4 %}open{% endif %}>
                                                                                    <summary {% if current_path == s4.path %}class="rounded bg-gray-500/15"{% endif %}>
                                                                                        <a class="hover:no-underline" href="{{ get_url(path=s4.path, lang=lang) | safe }}">{{ s4.title }}</a>
                                                                                    </summary>
                                                                                    <ul>
                                                                                        {# Level 5 #}
                                                                                        {% for s5_path in s4.subsections %}
                                                                                            {% set s5 = get_section(path=s5_path) %}
                                                                                            {% set is_active5 = current_path is starting_with(s5.path) %}
                                                                                            <li>
                                                                                                {% if s5.subsections or s5.pages %}
                                                                                                    <details {% if is_active5 or (config.extra.sidebar_expand_depth | default(0)) >= 5 %}open{% endif %}>
                                                                                                        <summary {% if current_path == s5.path %}class="rounded bg-gray-500/15"{% endif %}>
                                                                                                            <a class="hover:no-underline" href="{{ get_url(path=s5.path, lang=lang) | safe }}">{{ s5.title }}</a>
                                                                                                        </summary>
                                                                                                        {# Pages at Level 5 #}
                                                                                                        {% if s5.pages %}
                                                                                                            {% for page in s5.pages %}
                                                                                                                <li {% if current_path == page.path %}class="rounded bg-gray-500/15"{% endif %}>
                                                                                                                    <a class="hover:no-underline" href="{{ get_url(path=page.path, lang=lang) | safe }}">{{ page.title }}</a>
                                                                                                                </li>
                                                                                                            {% endfor %}
                                                                                                        {% endif %}
                                                                                                    </details>
                                                                                                {% else %}
                                                                                                    <a {% if current_path == s5.path %}class="rounded bg-gray-500/15"{% endif %} href="{{ get_url(path=s5.path, lang=lang) | safe }}">{{ s5.title }}</a>
                                                                                                {% endif %}
                                                                                            </li>
                                                                                        {% endfor %}
                                                                                        {# Pages at Level 4 #}
                                                                                        {% if s4.pages %}
                                                                                            {% for page in s4.pages %}
                                                                                                <li {% if current_path == page.path %}class="rounded bg-gray-500/15"{% endif %}>
                                                                                                    <a class="hover:no-underline" href="{{ get_url(path=page.path, lang=lang) | safe }}">{{ page.title }}</a>
                                                                                                </li>
                                                                                            {% endfor %}
                                                                                        {% endif %}
                                                                                    </ul>
                                                                                </details>
                                                                            {% else %}
                                                                                <a {% if current_path == s4.path %}class="rounded bg-gray-500/15"{% endif %} href="{{ get_url(path=s4.path, lang=lang) | safe }}">{{ s4.title }}</a>
                                                                            {% endif %}
                                                                        </li>
                                                                    {% endfor %}
                                                                    {# Pages at Level 3 #}
                                                                    {% if s3.pages %}
                                                                        {% for page in s3.pages %}
                                                                            <li {% if current_path == page.path %}class="rounded bg-gray-500/15"{% endif %}>
                                                                                <a class="hover:no-underline" href="{{ get_url(path=page.path, lang=lang) | safe }}">{{ page.title }}</a>
                                                                            </li>
                                                                        {% endfor %}
                                                                    {% endif %}
                                                                </ul>
                                                            </details>
                                                        {% else %}
                                                            <a {% if current_path == s3.path %}class="rounded bg-gray-500/15"{% endif %} href="{{ get_url(path=s3.path, lang=lang) | safe }}">{{ s3.title }}</a>
                                                        {% endif %}
                                                    </li>
                                                {% endfor %}
                                                {# Pages at Level 2 #}
                                                {% if s2.pages %}
                                                    {% for page in s2.pages %}
                                                        <li {% if current_path == page.path %}class="rounded bg-gray-500/15"{% endif %}>
                                                            <a class="hover:no-underline" href="{{ get_url(path=page.path, lang=lang) | safe }}">{{ page.title }}</a>
                                                        </li>
                                                    {% endfor %}
                                                {% endif %}
                                            </ul>
                                        </details>
                                    {% else %}
                                        <a {% if current_path == s2.path %}class="rounded bg-gray-500/15"{% endif %} href="{{ get_url(path=s2.path, lang=lang) | safe }}">{{ s2.title }}</a>
                                    {% endif %}
                                </li>
                            {% endfor %}
                            {% if s1.pages %}
                                {% for page in s1.pages %}
                                    <li {% if current_path == page.path %}class="rounded bg-gray-500/15"{% endif %}>
                                        <a class="hover:no-underline" href="{{ get_url(path=page.path, lang=lang) | safe }}">{{ page.title }}</a>
                                    </li>
                                {% endfor %}
                            {% endif %}
                        </ul>
                    </details>
                {% else %}
                    <a {% if current_path == s1.path %}class="rounded bg-gray-500/15"{% endif %} href="{{ get_url(path=s1.path, lang=lang) | safe }}">{{ s1.title }}</a>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
</div>
{% endmacro sidebar %}
